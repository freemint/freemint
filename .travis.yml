language: c
os: linux
dist: trusty
sudo: required

compiler:
   - m68k-atari-mint-gcc

before_install:
  - 'sh ./.travis/install-cross-mint.sh'
  - 'openssl aes-256-cbc -K $encrypted_8fe468c72adb_key -iv $encrypted_8fe468c72adb_iv -in .travis/id_rsa.pem.enc -out .travis/id_rsa.pem -d'

script:
  - cd sys && make 000 CROSS=yes && cd ..

after_success:
  - if [ "${TRAVIS_EVENT_TYPE}" = "push" ];
    then
        eval "$(ssh-agent -s)";
        chmod 600 .travis/id_rsa.pem;
        ssh-add .travis/id_rsa.pem;
        export TRAVIS_COMMIT_SHORT=$(git log -n1 --format="%h")
        export ID=$(git log -n1 --format="%cd-%h" --date=short);
        cd ..;
        git clone git@github.com:mikrosk/freemint.github.io.git;
        cd freemint.github.io;
        git rm -f --ignore-unmatch builds/freemint/{*.tar.bz2,*.zip};
        cp ../freemint/sys/libkern/libkern000.a builds/freemint/xxx-$ID.tar.bz2;
        cp ../freemint/sys/libkern/libkern000.a builds/freemint/xxx-$ID.zip;
        git add builds/freemint/{*.tar.bz2,*.zip} && git commit -m "https://github.com/mikrosk/freemint.github.io/tree/master/builds/freemint mikrosk/freemint#2" && git push;
    fi
